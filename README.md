# Device Auth

## 1. Description

Кластер сервисов, обеспечивающих авторизацию пользователя через мобильный телефон, как это сделано в банковских приложениях

## 2. Quick explanation / Flow

Есть два сервиса - user-service и device-service

Первый отвечает за работу с пользователя, второй - мобильными телефона

Сначала нужно в зарегистрировать юзера в user-service:
POST localhost:8080/api/v1/auth/sign-in
```{
"email" : "xxx@gmail.com",
"password" : "xxx",
"phoneNumber" : "xxx"
}```

P.S. у пользователей можно подтверждать почту в POST POST /verify-email/{id}. Вместо id нужно подставить uuid, приходящий в пиьсме

Далее идём к device-service и запрашиваем регистрацию устройства:
POST localhost:8081/api/v1/auth/sign-in
```{
"phoneNumber" : "+xxx"
}```
Он возвращает:
```{
"codeToken": "token"
}```
Это токен, с которым нужно будет подтвердить устройство (мол после запроса на устройство придёт смс, но денег на телефонию нет), только код надо будет смотреть в логах device-service, там 5 символов будут

Подтверждаем устройство:
POST localhost:8081/api/v1/auth/verify-device?code=(тут код) с полученным токеном
После запроса придёт уже device токен, с которым далее нужно трогать login и установку пина

Установка пина:
POST localhost:8081/api/v1/auth/set-pin
```{
"pinCode" : "123"
}```
Если всё ок - 200 и пустое тело

Далее можно логиниться:
POST localhost:8081/api/v1/auth/login
```{
"pin":"123"
}```
И в ответ получим токен user-a, которому этот телефон привязан)

Чтобы его проверить, можно получить инфо о юзере в user-service:
GET localhost:8080/api/v1/user/my

